<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Sustantivo</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* Variables CSS para personalización */
        :root {
            --primary: #07145e;
            --secondary: #f59e42;
            --success: #10b981;
            --danger: #ef4444;
            --bg-start: #1a3a5f;
            --bg-end: #0d2340;
            --card-bg: #FFFFFF;
            --text-dark: #1e3a8a;
            --text-medium: #334155;
            --text-light: #6b7280;
            --hint-bg: #e0effc;
            --confetti-colors: #d946ef, #ff9f43, #3b82f6, #10b981, #facc15;
            --shadow: 0px 8px 24px rgba(0, 0, 0, 0.1);
            --transition: 180ms ease;
            --final-score-color: #0055e0;
            --container-max-width: 1200px;
            /* Color para todos los botones de opción */
            --option-color: #BFDBFE; /* Azul claro */
        }

        /* Estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to bottom, var(--bg-start), var(--bg-end));
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            position: relative;
            overflow-x: hidden;
        }

        /* Contenedor principal */
        .container {
            width: 100%;
            max-width: var(--container-max-width);
            background-color: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        /* Tipografía */
        h1, h2, h3 {
            margin-bottom: 16px;
            color: var(--text-dark);
            font-weight: 700;
        }

        h1 {
            font-size: 2.5em;
            text-align: center;
            color: var(--primary);
        }

        h2 {
            font-size: 1.8em;
        }

        h3 {
            font-size: 1.4em;
        }

        p {
            margin-bottom: 16px;
            color: var(--text-light);
        }

        /* Botones */
        .btn {
            display: inline-block;
            padding: 15px 40px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition);
            text-align: center;
            text-decoration: none;
            min-height: 44px;
            min-width: 44px;
            position: relative;
            z-index: 10;
        }

        .btn:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background-color: var(--primary);
        }

        .btn-primary:hover {
            filter: brightness(1.1);
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            filter: brightness(1.1);
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            filter: brightness(1.1);
        }

        .btn-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: 50%;
            background-color: transparent;
            color: var(--text-dark);
            position: relative;
            z-index: 10;
        }

        .btn-icon:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
            position: relative;
            z-index: 10;
        }

        .btn-group-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
            position: relative;
            z-index: 10;
        }

        /* Pantallas */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
            position: relative;
            z-index: 5;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Pantalla de inicio */
        .start-screen {
            text-align: center;
        }

        .start-screen h1 {
            margin-bottom: 24px;
        }

        .start-screen h2 {
            color: var(--text-medium);
            margin-bottom: 20px;
        }

        .start-screen p {
            max-width: 600px;
            margin: 0 auto 24px;
            font-size: 1.2em;
            color: var(--text-light);
        }

        .hint-card {
            background-color: var(--hint-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 20px auto;
            max-width: 650px;
            color: var(--text-medium);
            font-size: 1.1em;
        }

        .hint-card span {
            font-weight: 700;
            color: var(--secondary);
        }

        .start-image {
            max-width: 100%;
            margin: 20px auto;
            display: block;
            border-radius: 12px;
        }

        /* Barra de progreso */
        .progress-bar {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 24px;
            overflow: hidden;
            position: relative;
            z-index: 5;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--secondary);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: right;
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        /* Controles superiores */
        .top-controls {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 20;
        }

        .timer {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--card-bg);
            padding: 6px 12px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            font-weight: 600;
            font-size: 14px;
            z-index: 20;
        }

        .top-buttons {
            display: flex;
            gap: 8px;
        }

        /* Contenedor de palabra y opciones */
        .word-container {
            margin: 30px 0;
            text-align: center;
            position: relative;
            z-index: 5;
        }

        .word-display {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 24px;
            letter-spacing: 1px;
            padding: 10px 20px;
            background-color: rgba(59, 130, 246, 0.05);
            border-radius: 10px;
            display: inline-block;
            text-transform: capitalize;
        }

        .instruction-text {
            font-style: italic;
            color: var(--text-medium);
            margin: 10px 0 20px;
            font-size: 1.1em;
        }

        .options-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .option-btn {
            padding: 15px 30px;
            background-color: var(--option-color);
            color: #1e40af;
            border: 2px solid #93c5fd;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            position: relative;
            z-index: 10;
            min-width: 150px;
        }

        .option-btn:hover {
            background-color: #93c5fd;
            color: white;
            border-color: #60a5fa;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        .option-btn.correct {
            background-color: var(--success);
            color: white;
            border-color: var(--success);
            transform: scale(1.05);
        }

        .option-btn.incorrect {
            background-color: var(--danger);
            color: white;
            border-color: var(--danger);
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .option-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .option-btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* Feedback */
        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            display: none;
            animation: fadeIn 0.3s ease;
            position: relative;
            z-index: 5;
            font-size: 1.1em;
        }

        .feedback.success {
            background-color: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .feedback.error {
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .feedback.show {
            display: block;
        }

        /* Modal - Simplificado */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 30px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform var(--transition);
            position: relative;
            z-index: 1001;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
            transition: color var(--transition);
            position: relative;
            z-index: 10;
        }

        .modal-close:hover {
            color: var(--text-dark);
        }

        /* Estilos simplificados para el contenido del modal de ayuda */
        .help-content h3 {
            color: var(--primary);
            margin-bottom: 16px;
            font-size: 1.3em;
        }

        .help-section {
            margin-bottom: 24px;
        }

        .help-section h4 {
            color: var(--secondary);
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .help-section p {
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .help-examples {
            margin-top: 30px;
        }

        .example {
            background-color: rgba(255, 159, 67, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .example:last-child {
            margin-bottom: 0;
        }

        .example-title {
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 12px;
            font-size: 1.2em;
        }

        .example-step {
            margin-bottom: 10px;
            padding-left: 24px;
            position: relative;
            font-size: 1.1em;
        }

        .example-step:before {
            content: "•";
            position: absolute;
            left: 10px;
            color: var(--secondary);
        }

        .example-result {
            font-weight: 600;
            margin-top: 12px;
            font-size: 1.2em;
        }

        .example-explanation {
            font-style: italic;
            color: var(--text-light);
            margin-top: 12px;
            font-size: 1.1em;
        }

        /* Destaque simple para palabras clave */
        .highlight-word {
            font-weight: 700;
            color: var(--secondary);
        }

        /* Pantalla final */
        .final-screen {
            text-align: center;
        }

        .trophy {
            font-size: 80px;
            margin: 20px 0;
            animation: trophyAnimation 2s ease-in-out infinite;
            display: none;
        }

        .trophy.show {
            display: block;
        }

        @keyframes trophyAnimation {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            75% { transform: scale(1.1) rotate(-5deg); }
        }

        .final-score {
            font-size: 3.5em;
            font-weight: 700;
            color: var(--final-score-color) !important;
            margin: 20px 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .final-score.perfect {
            color: var(--final-score-color) !important;
        }

        .final-time {
            font-size: 20px;
            color: var(--text-light);
            margin-bottom: 24px;
        }

        .final-message {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 24px;
        }

        .credit {
            margin-top: 20px;
            font-size: 14px;
            color: var(--text-light);
        }

        .school-logo {
            max-width: 150px;
            margin: 20px auto;
            display: block;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: confetti-fall 3s linear forwards;
            z-index: 9999;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translate(0, 0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) rotate(360deg);
                opacity: 0;
            }
        }

        /* Puntuación en modo infinito */
        .infinite-score {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--card-bg);
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            font-weight: 600;
            font-size: 16px;
            z-index: 20;
        }

        /* Responsive */
        @media (min-width: 480px) {
            .container {
                padding: 30px;
            }
            
            h1 {
                font-size: 2.8em;
            }
            
            .word-display {
                font-size: 40px;
                padding: 12px 24px;
            }
            
            .trophy {
                font-size: 100px;
            }
        }
        
        @media (min-width: 768px) {
            h1 {
                font-size: 3.2em;
            }
            
            .word-display {
                font-size: 44px;
                padding: 14px 28px;
            }
            
            .top-controls {
                top: 20px;
                left: 20px;
            }
            
            .timer {
                top: 20px;
                right: 20px;
                padding: 10px 18px;
                font-size: 16px;
            }
            
            .trophy {
                font-size: 120px;
            }
        }

        /* Para pantallas muy pequeñas */
        @media (max-width: 767px) {
            .option-btn {
                width: 100%;
                max-width: 200px;
            }
            
            .word-display {
                font-size: 32px;
                padding: 8px 16px;
            }
        }

        /* Accesibilidad */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Animaciones reducidas */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .trophy {
                animation: none;
            }
        }
    </style>
</head>
<body>
    <div id="startScreen" class="screen start-screen active">
        <div class="container">
            <h1>El sustantivo</h1>
            <h2>Género y número de un sustantivo</h2>
            
            <div class="hint-card">
                Clasifica los siguientes sustantivos según su <span>género</span> (masculino o femenino) y su <span>número</span> (singular o plural).<br>
                <strong>Buena suerte.</strong>
            </div>
            
            <div class="btn-group">
                <button id="startBtn" class="btn" onclick="unlockAudio(); startGame()">Comenzar</button>
            </div>
            
            <img src="https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/refs/heads/main/Ni%C3%B1os.png" alt="Niños estudiando" class="start-image">
        </div>
    </div>

    <div id="gameScreen" class="screen">
        <div class="container">
            <div class="top-controls">
                <button id="soundBtn" class="btn btn-icon" aria-label="Activar sonido" onclick="unlockAudio(); toggleSound()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                </button>
                <button id="helpBtnGame" class="btn btn-icon" aria-label="Ayuda" onclick="unlockAudio(); toggleHelpModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </button>
            </div>
            
            <div class="timer" id="timer">00:00</div>
            
            <div id="infiniteScore" class="infinite-score" style="display: none;">Puntuación: 0</div>
            
            <div id="normalProgress" class="progress-text">1/10</div>
            <div id="normalProgressBar" class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 10%"></div>
            </div>
            
            <h2>Clasifica estos sustantivos según su género y número</h2>
            
            <div class="word-container">
                <div class="word-display" id="wordDisplay">Sustantivo</div>
                
                <div id="genderQuestion" class="question-container">
                    <p class="instruction-text">¿Cuál es su género?</p>
                    <div class="options-container">
                        <button id="masculineBtn" class="option-btn" onclick="unlockAudio(); checkGender('masculine')">Masculino</button>
                        <button id="feminineBtn" class="option-btn" onclick="unlockAudio(); checkGender('feminine')">Femenino</button>
                    </div>
                </div>
                
                <div id="numberQuestion" class="question-container" style="display: none;">
                    <p class="instruction-text">¿Cuál es su número?</p>
                    <div class="options-container">
                        <button id="singularBtn" class="option-btn" onclick="unlockAudio(); checkNumber('singular')">Singular</button>
                        <button id="pluralBtn" class="option-btn" onclick="unlockAudio(); checkNumber('plural')">Plural</button>
                    </div>
                </div>
            </div>
            
            <div class="btn-group-row">
                <button id="continueBtn" class="btn btn-success" style="display: none;" onclick="unlockAudio(); nextWord()">Continuar</button>
                <button id="exitInfiniteBtn" class="btn" style="display: none;" onclick="unlockAudio(); exitInfiniteMode()">Salir</button>
            </div>
            
            <div id="feedback" class="feedback" aria-live="polite"></div>
        </div>
    </div>

    <div id="finalScreen" class="screen final-screen">
        <div class="container">
            <div class="top-controls">
                <button id="soundBtnFinal" class="btn btn-icon" aria-label="Activar sonido" onclick="unlockAudio(); toggleSound()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                </button>
            </div>
            
            <h1>El sustantivo</h1>
            
            <div id="trophyContainer" class="trophy">🏆</div>
            
            <h2>Puntuación:</h2>
            <div class="final-score" id="finalScore">0</div>
            
            <div class="final-time" id="finalTime">Tiempo: 00:00</div>
            
            <p id="finalMessage"></p>
            
            <div class="btn-group">
                <button id="restartBtn" class="btn" onclick="unlockAudio(); restartGame()">Volver a jugar</button>
                <button id="infiniteModeBtn" class="btn btn-primary" onclick="unlockAudio(); startInfiniteMode()">Entrenamiento infinito</button>
            </div>
            
            <p class="credit">Created by Manuel J. Ventura</p>
            
            <img src="https://github.com/ManuelVS8/Efectos_audio/blob/1e2a36cdd1f8bedcb578a30f5ec5cc8f21c287fe/Siurot.png?raw=true" alt="Logo del colegio" class="school-logo">
        </div>
    </div>

    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>¿Cómo clasificar sustantivos?</h2>
                <button class="modal-close" id="closeHelpModal" onclick="unlockAudio(); toggleHelpModal()">×</button>
            </div>
            <div class="help-content">
                <h3>Pasos a seguir:</h3>
                <div class="help-section">
                    <p>1. Identifica el <span class="highlight-word">género</span> del sustantivo:</p>
                    <p>• Si puede llevar delante "el" o "los" es <span class="highlight-word">masculino</span></p>
                    <p>• Si puede llevar delante "la" o "las" es <span class="highlight-word">femenino</span></p>
                </div>
                
                <div class="help-section">
                    <p>2. Identifica el <span class="highlight-word">número</span> del sustantivo:</p>
                    <p>• Si se refiere a un solo elemento es <span class="highlight-word">singular</span></p>
                    <p>• Si se refiere a más de un elemento es <span class="highlight-word">plural</span></p>
                    <p>• Los plurales suelen terminar en -s / -es</p>
                </div>
                
                <div class="help-examples">
                    <h3>Ejemplos:</h3>
                    
                    <div class="example">
                        <div class="example-title">1️⃣ "Libro"</div>
                        <div class="example-step">Podemos decir "el libro" → es <span class="highlight-word">masculino</span></div>
                        <div class="example-step">Se refiere a un solo libro → es <span class="highlight-word">singular</span></div>
                        <div class="example-result">Resultado: Masculino singular</div>
                    </div>
                    
                    <div class="example">
                        <div class="example-title">2️⃣ "Mesas"</div>
                        <div class="example-step">Podemos decir "las mesas" → es <span class="highlight-word">femenino</span></div>
                        <div class="example-step">Termina en -s y se refiere a varias mesas → es <span class="highlight-word">plural</span></div>
                        <div class="example-result">Resultado: Femenino plural</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Base de datos de sustantivos - Actualizada con las correcciones
        const sustantivos = {
            'masculino-singular': [
                'Libro', 'Coche', 'Sol', 'Ordenador', 'Bolígrafo', 'Móvil', 'Pan', 'Queso', 'Zapato', 'Trabajo',
                'Tiempo', 'Reloj', 'Perro', 'Gato', 'Árbol', 'Parque', 'Restaurante', 'Actor', 'Profesor', 'Juez',
                'Viaje', 'Garaje', 'Mes', 'Lunes', 'Aire', 'Día', 'Mapa', 'Problema', 'Idioma', 'Poema', 'Planeta',
                'Tren', 'Autobús', 'Metro', 'Pueblo', 'Colegio', 'Edificio', 'Cine', 'Museo', 'Desayuno', 'Almuerzo',
                'Recuerdo', 'Corazón', 'Dolor', 'Calor', 'Motor', 'Color', 'Papel', 'Hotel', 'Nivel', 'Abuelo',
                'Primo', 'Tío', 'Vecino', 'Amigo', 'Camino', 'Destino', 'Juego', 'Fuego', 'Frío', 'Bar',
                'Café', 'Té', 'Pie', 'Brazo', 'Cuerpo', 'Cabello', 'Dedo', 'Hospital', 'Mineral', 'Animal',
                'Sacapuntas', 'Virus', 'Jersey', 'Cáliz', 'Lápiz', 'Arroz', 'Ajedrez', 'Puente', 'Campo', 'Sillón',
                'Balcón', 'Jamón', 'Anillo', 'Castillo', 'Verano', 'Invierno', 'Otoño', 'Dibujo', 'Teatro', 'Suelo',
                'Vaso', 'Espejo', 'Regalo', 'Futuro', 'Pasado', 'Presente', 'Balón', 'Cielo', 'Pimiento'
            ],
            'masculino-plural': [
                'Libros', 'Coches', 'Soles', 'Ordenadores', 'Bolígrafos', 'Móviles', 'Panes', 'Quesos', 'Zapatos', 'Trabajos',
                'Tiempos', 'Relojes', 'Perros', 'Gatos', 'Árboles', 'Parques', 'Restaurantes', 'Actores', 'Profesores', 'Jueces',
                'Viajes', 'Garajes', 'Meses', 'Lunes', 'Aires', 'Días', 'Mapas', 'Problemas', 'Idiomas', 'Poemas', 'Planetas',
                'Trenes', 'Autobuses', 'Metros', 'Pueblos', 'Colegios', 'Edificios', 'Cines', 'Museos', 'Desayunos', 'Almuerzos',
                'Recuerdos', 'Corazones', 'Dolores', 'Calores', 'Motores', 'Colores', 'Papeles', 'Hoteles', 'Niveles', 'Abuelos',
                'Primos', 'Tíos', 'Vecinos', 'Amigos', 'Caminos', 'Destinos', 'Juegos', 'Fuegos', 'Fríos', 'Bares',
                'Cafés', 'Tablones', 'Pies', 'Brazos', 'Cuerpos', 'Cabellos', 'Dedos', 'Hospitales', 'Minerales', 'Animales',
                'Sacapuntas', 'Virus', 'Jerséis', 'Estuches', 'Lápices', 'Arroces', 'Ajedreces', 'Puentes', 'Campos', 'Sillones',
                'Balcones', 'Jamones', 'Anillos', 'Castillos', 'Veranos', 'Inviernos', 'Otoños', 'Dibujos', 'Teatros', 'Suelos',
                'Vasos', 'Espejos', 'Regalos', 'Futuros', 'Pasados', 'Presentes', 'Balones', 'Cielos', 'Pimientos'
            ],
            'femenino-singular': [
                'Casa', 'Mesa', 'Silla', 'Ventana', 'Puerta', 'Flor', 'Calle', 'Ciudad', 'Noche', 'Tarde',
                'Mano', 'Foto', 'Moto', 'Radio', 'Televisión', 'Canción', 'Emoción', 'Razón', 'Verdad', 'Libertad',
                'Amistad', 'Actitud', 'Juventud', 'Salud', 'Pared', 'Oreja', 'Voz', 'Paz', 'Nariz', 'Clase',
                'Gente', 'Leche', 'Carne', 'Tostada', 'Cena', 'Comida', 'Bebida', 'Familia', 'Hermana', 'Madre',
                'Abuela', 'Prima', 'Amiga', 'Vecina', 'Doctora', 'Actriz', 'Poetisa', 'Pintora', 'Profesora', 'Secretaria',
                'Oficina', 'Tienda', 'Ropa', 'Falda', 'Camisa', 'Chaqueta', 'Playa', 'Montaña', 'Tierra', 'Estrella',
                'Luna', 'Nube', 'Lluvia', 'Niebla', 'Cerveza', 'Copa', 'Taza', 'Botella', 'Cuchara', 'Servilleta',
                'Historia', 'Memoria', 'Alegría', 'Tristeza', 'Esperanza', 'Máquina', 'Gasolina', 'Carretera', 'Acera', 'Bicicleta',
                'Barca', 'Carta', 'Respuesta', 'Pregunta', 'Idea', 'Zona', 'Pluma', 'Arena', 'Piedra', 'Regla',
                'Prueba', 'Tribu', 'Virtud', 'Multitud', 'Imagen', 'Llave', 'Cáscara', 'Fiebre'
            ],
            'femenino-plural': [
                'Casas', 'Mesas', 'Sillas', 'Ventanas', 'Puertas', 'Flores', 'Calles', 'Ciudades', 'Noches', 'Tardes',
                'Manos', 'Fotos', 'Motos', 'Radios', 'Alfombras', 'Canciones', 'Emociones', 'Razones', 'Verdades', 'Libertades',
                'Amistades', 'Actitudes', 'Arrugas', 'Paredes', 'Sábanas', 'Medidas', 'Antenas', 'Amapolas', 'Ballenas', 'Jirafas',
                'Fuentes', 'Leches', 'Carnes', 'Tostadas', 'Cenas', 'Comidas', 'Bebidas', 'Carreteras', 'Hermanas', 'Madres',
                'Abuelas', 'Primas', 'Amigas', 'Vecinas', 'Doctoras', 'Actrices', 'Poetisas', 'Pintoras', 'Profesoras', 'Secretarias',
                'Oficinas', 'Tiendas', 'Ropas', 'Familias', 'Camisas', 'Chaquetas', 'Playas', 'Montañas', 'Tierras', 'Estrellas',
                'Lunas', 'Nubes', 'Lluvias', 'Nieblas', 'Cervezas', 'Copas', 'Tazas', 'Botellas', 'Cucharas', 'Servilletas',
                'Historias', 'Memorias', 'Alegrías', 'Tristezas', 'Esperanzas', 'Máquinas', 'Gasolinas', 'Aceras', 'Bicicletas',
                'Barcas', 'Cartas', 'Respuestas', 'Preguntas', 'Ideas', 'Zonas', 'Plumas', 'Arenas', 'Piedras', 'Reglas',
                'Pruebas', 'Tribus', 'Virtudes', 'Multitudes', 'Imágenes', 'Llaves', 'Almohadas', 'Fiebres', 'Olas'
            ]
        };

        // Estado del juego
        let gameState = {
            words: [],
            currentWordIndex: 0,
            score: 0,
            startTime: null,
            timerInterval: null,
            soundEnabled: true,
            currentWord: '',
            currentGender: '',
            currentNumber: '',
            gameMode: 'normal', // 'normal' o 'infinite'
            infiniteScore: 0,
            wordsUsed: [],
            questionStep: 'gender', // 'gender' o 'number'
            isProcessing: false // Para evitar múltiples clics rápidos
        };

        // Elementos del DOM
        const elements = {
            startScreen: document.getElementById('startScreen'),
            gameScreen: document.getElementById('gameScreen'),
            finalScreen: document.getElementById('finalScreen'),
            startBtn: document.getElementById('startBtn'),
            helpBtnGame: document.getElementById('helpBtnGame'),
            helpModal: document.getElementById('helpModal'),
            closeHelpModal: document.getElementById('closeHelpModal'),
            wordDisplay: document.getElementById('wordDisplay'),
            genderQuestion: document.getElementById('genderQuestion'),
            numberQuestion: document.getElementById('numberQuestion'),
            masculineBtn: document.getElementById('masculineBtn'),
            feminineBtn: document.getElementById('feminineBtn'),
            singularBtn: document.getElementById('singularBtn'),
            pluralBtn: document.getElementById('pluralBtn'),
            continueBtn: document.getElementById('continueBtn'),
            exitInfiniteBtn: document.getElementById('exitInfiniteBtn'),
            soundBtn: document.getElementById('soundBtn'),
            soundBtnFinal: document.getElementById('soundBtnFinal'),
            feedback: document.getElementById('feedback'),
            progressText: document.getElementById('normalProgress'),
            progressFill: document.getElementById('progressFill'),
            normalProgressBar: document.getElementById('normalProgressBar'),
            normalProgress: document.getElementById('normalProgress'),
            infiniteScore: document.getElementById('infiniteScore'),
            timer: document.getElementById('timer'),
            finalScore: document.getElementById('finalScore'),
            finalTime: document.getElementById('finalTime'),
            finalMessage: document.getElementById('finalMessage'),
            restartBtn: document.getElementById('restartBtn'),
            infiniteModeBtn: document.getElementById('infiniteModeBtn'),
            trophyContainer: document.getElementById('trophyContainer')
        };

        // Sistema de sonido con archivos externos
        const soundFiles = {
            correct: 'https://github.com/ManuelVS8/Efectos_audio/blob/7b86808e254100aeaba6285b3e0b82650ae78055/Correcto.mp3?raw=true',
            error: 'https://github.com/ManuelVS8/Efectos_audio/blob/7b86808e254100aeaba6285b3e0b82650ae78055/Error.mp3?raw=true',
            completed: 'https://github.com/ManuelVS8/Efectos_audio/blob/7b86808e254100aeaba6285b3e0b82650ae78055/Completado.mp3?raw=true',
            victory: 'https://github.com/ManuelVS8/Efectos_audio/blob/7b86808e254100aeaba6285b3e0b82650ae78055/Termin%C3%A9.mp3?raw=true',
            tap: 'https://github.com/ManuelVS8/Efectos_audio/blob/37b3eb2da9c15c04dfb71dfe1be60f088ea3cdfc/Tap.mp3?raw=true'
        };
        
        const sounds = {};
        let audioUnlocked = false;

        // Cargar todos los sonidos al inicio
        Object.keys(soundFiles).forEach(key => {
            sounds[key] = new Audio(soundFiles[key]);
            sounds[key].load();
        });

        // Función de desbloqueo de audio
        function unlockAudio() {
            if (audioUnlocked) return;
            
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                
                if (ctx.state === 'suspended') {
                    ctx.resume();
                }

                const buffer = ctx.createBuffer(1, 1, 22050);
                const source = ctx.createBufferSource();
                source.buffer = buffer;
                source.connect(ctx.destination);
                
                source.start(0);
                
                source.onended = () => {
                    audioUnlocked = true;
                    console.log("AudioContext desbloqueado.");
                    Object.keys(sounds).forEach(key => {
                        sounds[key].load();
                    });
                };
            } catch (e) {
                console.warn("Error al intentar desbloquear AudioContext, usando fallback de Audio()");
                audioUnlocked = true;
            } finally {
                if (!audioUnlocked) {
                    audioUnlocked = true;
                    Object.keys(sounds).forEach(key => {
                        sounds[key].load();
                    });
                }
            }
        }

        // Funciones para reproducir sonidos
        function reproducirSonidoCorrecto() {
            if (audioUnlocked && sounds.correct && gameState.soundEnabled) {
                sounds.correct.currentTime = 0;
                sounds.correct.play().catch(e => console.log("Error al reproducir sonido correcto:", e));
            }
        }

        function reproducirSonidoError() {
            if (audioUnlocked && sounds.error && gameState.soundEnabled) {
                sounds.error.currentTime = 0;
                sounds.error.play().catch(e => console.log("Error al reproducir sonido de error:", e));
            }
        }

        function reproducirSonidoCompletado() {
            if (audioUnlocked && sounds.completed && gameState.soundEnabled) {
                sounds.completed.currentTime = 0;
                sounds.completed.play().catch(e => console.log("Error al reproducir sonido completado:", e));
            }
        }

        function reproducirSonidoVictoria() {
            if (audioUnlocked && sounds.victory && gameState.soundEnabled) {
                sounds.victory.currentTime = 0;
                sounds.victory.play().catch(e => console.log("Error al reproducir sonido de victoria:", e));
            }
        }

        function reproducirSonidoTap() {
            if (audioUnlocked && sounds.tap && gameState.soundEnabled) {
                sounds.tap.currentTime = 0;
                sounds.tap.play().catch(e => console.log("Error al reproducir sonido tap:", e));
            }
        }

        // Función para generar palabras para el juego - Mejorada para evitar repeticiones
        function generateWords() {
            const words = [];
            const usedWordsInThisGame = new Set();
            
            // Función auxiliar para obtener una palabra aleatoria sin repetir
            function getRandomWordFromType(type) {
                const availableWords = sustantivos[type].filter(word => 
                    !gameState.wordsUsed.includes(word) && !usedWordsInThisGame.has(word)
                );
                
                if (availableWords.length === 0) {
                    // Si no hay palabras disponibles, reiniciar el array de palabras usadas globalmente
                    console.warn(`No hay palabras disponibles de tipo ${type}, reiniciando palabras usadas globalmente`);
                    // Reiniciar solo las palabras de este tipo
                    const allWordsOfType = sustantivos[type];
                    const randomIndex = Math.floor(Math.random() * allWordsOfType.length);
                    return allWordsOfType[randomIndex];
                }
                
                const randomIndex = Math.floor(Math.random() * availableWords.length);
                const word = availableWords[randomIndex];
                usedWordsInThisGame.add(word);
                return word;
            }
            
            // Añadir 2 de cada tipo
            for (let i = 0; i < 2; i++) {
                words.push({
                    word: getRandomWordFromType('masculino-singular'),
                    type: 'masculino-singular'
                });
                words.push({
                    word: getRandomWordFromType('masculino-plural'),
                    type: 'masculino-plural'
                });
                words.push({
                    word: getRandomWordFromType('femenino-singular'),
                    type: 'femenino-singular'
                });
                words.push({
                    word: getRandomWordFromType('femenino-plural'),
                    type: 'femenino-plural'
                });
            }
            
            // Añadir 2 aleatorios
            const types = ['masculino-singular', 'masculino-plural', 'femenino-singular', 'femenino-plural'];
            for (let i = 0; i < 2; i++) {
                const randomType = types[Math.floor(Math.random() * types.length)];
                words.push({
                    word: getRandomWordFromType(randomType),
                    type: randomType
                });
            }
            
            // Mezclar el orden de las palabras
            return shuffleArray(words);
        }

        // Función para mezclar un array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Función para mostrar la palabra actual
        function showWord() {
            const wordObj = gameState.words[gameState.currentWordIndex];
            gameState.currentWord = wordObj.word;
            gameState.currentGender = wordObj.type.includes('masculino') ? 'masculine' : 'feminine';
            gameState.currentNumber = wordObj.type.includes('singular') ? 'singular' : 'plural';
            gameState.questionStep = 'gender';
            gameState.isProcessing = false;
            
            elements.wordDisplay.textContent = gameState.currentWord;
            
            // Actualizar progreso (solo en modo normal)
            if (gameState.gameMode === 'normal') {
                elements.progressText.textContent = `${gameState.currentWordIndex + 1}/${gameState.words.length}`;
                elements.progressFill.style.width = `${((gameState.currentWordIndex + 1) / gameState.words.length) * 100}%`;
            }
            
            // Resetear botones
            resetButtons();
            
            // Mostrar pregunta de género
            elements.genderQuestion.style.display = 'block';
            elements.numberQuestion.style.display = 'none';
            
            // Ocultar feedback y botón continuar
            elements.feedback.classList.remove('show');
            elements.continueBtn.style.display = 'none';
        }

        // Función para resetear los botones
        function resetButtons() {
            elements.masculineBtn.disabled = false;
            elements.feminineBtn.disabled = false;
            elements.singularBtn.disabled = false;
            elements.pluralBtn.disabled = false;
            
            elements.masculineBtn.classList.remove('correct', 'incorrect');
            elements.feminineBtn.classList.remove('correct', 'incorrect');
            elements.singularBtn.classList.remove('correct', 'incorrect');
            elements.pluralBtn.classList.remove('correct', 'incorrect');
        }

        // Función para comprobar el género
        function checkGender(selectedGender) {
            if (gameState.isProcessing) return;
            gameState.isProcessing = true;
            
            const correctGender = gameState.currentGender;
            const isCorrect = selectedGender === correctGender;
            
            // Deshabilitar botones de género
            elements.masculineBtn.disabled = true;
            elements.feminineBtn.disabled = true;
            
            // Resaltar botón correcto e incorrecto
            if (selectedGender === 'masculine') {
                elements.masculineBtn.classList.add(isCorrect ? 'correct' : 'incorrect');
            } else {
                elements.feminineBtn.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
            
            if (!isCorrect) {
                // Resaltar también el botón correcto
                if (correctGender === 'masculine') {
                    elements.masculineBtn.classList.add('correct');
                } else {
                    elements.feminineBtn.classList.add('correct');
                }
                
                // Mostrar feedback de error
                elements.feedback.className = 'feedback error show';
                elements.feedback.innerHTML = `<p><strong>No es correcto.</strong> El género correcto es ${correctGender === 'masculine' ? 'masculino' : 'femenino'}.</p>`;
                
                // Reproducir sonido de error
                reproducirSonidoError();
                
                // Mostrar botón continuar
                elements.continueBtn.style.display = 'inline-block';
            } else {
                // Reproducir sonido de éxito
                reproducirSonidoCorrecto();
                
                // Mostrar pregunta de número automáticamente
                setTimeout(() => {
                    elements.genderQuestion.style.display = 'none';
                    elements.numberQuestion.style.display = 'block';
                    gameState.isProcessing = false;
                }, 1000);
            }
        }

        // Función para comprobar el número
        function checkNumber(selectedNumber) {
            if (gameState.isProcessing) return;
            gameState.isProcessing = true;
            
            const correctNumber = gameState.currentNumber;
            const isCorrect = selectedNumber === correctNumber;
            
            // Deshabilitar botones de número
            elements.singularBtn.disabled = true;
            elements.pluralBtn.disabled = true;
            
            // Resaltar botón correcto e incorrecto
            if (selectedNumber === 'singular') {
                elements.singularBtn.classList.add(isCorrect ? 'correct' : 'incorrect');
            } else {
                elements.pluralBtn.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
            
            if (!isCorrect) {
                // Resaltar también el botón correcto
                if (correctNumber === 'singular') {
                    elements.singularBtn.classList.add('correct');
                } else {
                    elements.pluralBtn.classList.add('correct');
                }
                
                // Mostrar feedback de error
                elements.feedback.className = 'feedback error show';
                elements.feedback.innerHTML = `<p><strong>No es correcto.</strong> El número correcto es ${correctNumber === 'singular' ? 'singular' : 'plural'}.</p>`;
                
                // Reproducir sonido de error
                reproducirSonidoError();
                
                // Mostrar botón continuar
                elements.continueBtn.style.display = 'inline-block';
            } else {
                // Reproducir sonido de éxito
                reproducirSonidoCorrecto();
                
                // Actualizar puntuación
                gameState.score += 1;
                
                // Si estamos en modo infinito, aumentar puntuación
                if (gameState.gameMode === 'infinite') {
                    gameState.infiniteScore += 10;
                    elements.infiniteScore.textContent = `Puntuación: ${gameState.infiniteScore}`;
                }
                
                // Pasar automáticamente a la siguiente palabra
                setTimeout(() => {
                    nextWord();
                }, 1500);
            }
        }

        // Función para continuar a la siguiente palabra
        function nextWord() {
            reproducirSonidoTap();
            
            if (gameState.gameMode === 'normal') {
                gameState.currentWordIndex++;
                
                if (gameState.currentWordIndex < gameState.words.length) {
                    showWord();
                } else {
                    endGame();
                }
            } else {
                // Modo infinito: generar una nueva palabra
                generateNewInfiniteWord();
            }
        }

        // Función para generar una nueva palabra en modo infinito
        function generateNewInfiniteWord() {
            const types = ['masculino-singular', 'masculino-plural', 'femenino-singular', 'femenino-plural'];
            const randomType = types[Math.floor(Math.random() * types.length)];
            
            // Obtener palabra sin repetir
            const availableWords = sustantivos[randomType].filter(word => !gameState.wordsUsed.includes(word));
            let selectedWord;
            
            if (availableWords.length === 0) {
                // Si no hay palabras disponibles, reiniciar el array de palabras usadas
                console.warn("Reiniciando palabras usadas en modo infinito");
                gameState.wordsUsed = [];
                selectedWord = sustantivos[randomType][Math.floor(Math.random() * sustantivos[randomType].length)];
            } else {
                const randomIndex = Math.floor(Math.random() * availableWords.length);
                selectedWord = availableWords[randomIndex];
            }
            
            gameState.wordsUsed.push(selectedWord);
            
            const newWord = {
                word: selectedWord,
                type: randomType
            };
            
            gameState.words = [newWord];
            gameState.currentWordIndex = 0;
            
            showWord();
        }

        // Función para iniciar el juego
        function startGame() {
            reproducirSonidoTap();
            
            // Reiniciar estado del juego
            gameState.words = generateWords();
            gameState.currentWordIndex = 0;
            gameState.score = 0;
            gameState.startTime = Date.now();
            gameState.gameMode = 'normal';
            gameState.infiniteScore = 0;
            gameState.wordsUsed = [];
            gameState.isProcessing = false;
            
            // Iniciar temporizador
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            gameState.timerInterval = setInterval(updateTimer, 1000);
            
            // Cambiar a pantalla de juego
            elements.startScreen.classList.remove('active');
            elements.gameScreen.classList.add('active');
            
            // Mostrar elementos de modo normal
            elements.normalProgress.style.display = 'block';
            elements.normalProgressBar.style.display = 'block';
            elements.infiniteScore.style.display = 'none';
            elements.exitInfiniteBtn.style.display = 'none';
            
            // Mostrar primera palabra
            showWord();
        }

        // Función para iniciar el modo infinito
        function startInfiniteMode() {
            reproducirSonidoTap();
            
            // Reiniciar estado del juego
            gameState.words = [null]; // Placeholder para la primera palabra
            gameState.currentWordIndex = 0;
            gameState.score = 0;
            gameState.startTime = Date.now();
            gameState.gameMode = 'infinite';
            gameState.infiniteScore = 0;
            gameState.wordsUsed = [];
            gameState.isProcessing = false;
            
            // Iniciar temporizador
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            gameState.timerInterval = setInterval(updateTimer, 1000);
            
            // Cambiar a pantalla de juego
            elements.finalScreen.classList.remove('active');
            elements.gameScreen.classList.add('active');
            
            // Mostrar elementos de modo infinito
            elements.normalProgress.style.display = 'none';
            elements.normalProgressBar.style.display = 'none';
            elements.infiniteScore.style.display = 'block';
            elements.exitInfiniteBtn.style.display = 'inline-block';
            elements.infiniteScore.textContent = `Puntuación: 0`;
            
            // Generar primera palabra
            generateNewInfiniteWord();
        }

        // Función para salir del modo infinito
        function exitInfiniteMode() {
            reproducirSonidoTap();
            
            // Detener temporizador
            clearInterval(gameState.timerInterval);
            
            // Cambiar a pantalla de inicio
            elements.gameScreen.classList.remove('active');
            elements.startScreen.classList.add('active');
        }

        // Función para actualizar el temporizador
        function updateTimer() {
            if (!gameState.startTime) return;
            
            const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            elements.timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Función para finalizar el juego
        function endGame() {
            // Detener temporizador
            clearInterval(gameState.timerInterval);
            
            // Calcular puntuación
            const score = (gameState.score * 100) / 10;
            
            // Calcular tiempo
            const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Cambiar a pantalla final
            elements.gameScreen.classList.remove('active');
            elements.finalScreen.classList.add('active');
            
            // Mostrar resultados
            elements.finalScore.textContent = score;
            elements.finalTime.textContent = `Tiempo: ${timeStr}`;
            
            // Mensaje motivador
            if (score === 100) {
                elements.finalMessage.textContent = '¡Genial! ¡Puntuación perfecta!';
                elements.trophyContainer.classList.add('show');
                elements.finalScore.classList.add('perfect');
                
                // Celebración con confeti
                createConfetti();
                
                // Reproducir melodía de victoria después de un pequeño retraso
                setTimeout(() => {
                    reproducirSonidoVictoria();
                }, 500);
            } else {
                elements.trophyContainer.classList.remove('show');
                elements.finalScore.classList.remove('perfect');
                
                if (score >= 80) {
                    elements.finalMessage.textContent = 'Casi lo logras. ¡Sigue practicando!';
                } else if (score >= 50) {
                    elements.finalMessage.textContent = 'No está mal, pero aún puedes hacerlo mejor';
                } else {
                    elements.finalMessage.textContent = 'Vaya desastre... ¿Seguro que has estudiado?';
                }
                
                // Reproducir sonido de completado después de un pequeño retraso
                setTimeout(() => {
                    reproducirSonidoCompletado();
                }, 500);
            }
        }

        // Función para crear confeti
        function createConfetti() {
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    const x = Math.random() * window.innerWidth;
                    const y = -10;
                    
                    const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ffa500', '#ff69b4'];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    confetti.style.left = `${x}px`;
                    confetti.style.top = `${y}px`;
                    confetti.style.backgroundColor = color;
                    
                    const size = Math.random() * 10 + 5;
                    confetti.style.width = `${size}px`;
                    confetti.style.height = `${size}px`;
                    
                    const tx = (Math.random() - 0.5) * 100;
                    const ty = window.innerHeight + 10;
                    
                    confetti.style.setProperty('--tx', `${tx}px`);
                    confetti.style.setProperty('--ty', `${ty}px`);
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }, i * 30);
            }
        }

        // Función para reiniciar el juego
        function restartGame() {
            reproducirSonidoTap();
            
            elements.finalScreen.classList.remove('active');
            elements.startScreen.classList.add('active');
        }

        // Función para alternar sonido
        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            
            const soundIcon = `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            `;
            
            const muteIcon = `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <line x1="23" y1="9" x2="17" y2="15"></line>
                    <line x1="17" y1="9" x2="23" y2="15"></line>
                </svg>
            `;
            
            if (gameState.soundEnabled) {
                elements.soundBtn.innerHTML = soundIcon + '<path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>';
                if (elements.soundBtnFinal) {
                    elements.soundBtnFinal.innerHTML = soundIcon + '<path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>';
                }
            } else {
                elements.soundBtn.innerHTML = soundIcon + '<line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>';
                if (elements.soundBtnFinal) {
                    elements.soundBtnFinal.innerHTML = soundIcon + '<line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>';
                }
            }
            
            reproducirSonidoTap();
        }

        // Función para mostrar/ocultar modal de ayuda
        function toggleHelpModal() {
            reproducirSonidoTap();
            elements.helpModal.classList.toggle('active');
        }

        // Soporte de teclado
        document.addEventListener('keydown', (e) => {
            if (!elements.gameScreen.classList.contains('active')) return;
            
            if (!audioUnlocked) {
                unlockAudio();
            }

            if (gameState.questionStep === 'gender') {
                if (e.key === '1' || e.key === 'm' || e.key === 'M') {
                    checkGender('masculine');
                } else if (e.key === '2' || e.key === 'f' || e.key === 'F') {
                    checkGender('feminine');
                }
            } else if (gameState.questionStep === 'number') {
                if (e.key === '1' || e.key === 's' || e.key === 'S') {
                    checkNumber('singular');
                } else if (e.key === '2' || e.key === 'p' || e.key === 'P') {
                    checkNumber('plural');
                }
            }
            
            if (e.key === 'Enter') {
                if (elements.continueBtn.style.display !== 'none') {
                    nextWord();
                }
            }
            
            if (e.key === 'Escape' && elements.helpModal.classList.contains('active')) {
                toggleHelpModal();
            }
        });

        // Cerrar modal al hacer clic fuera
        elements.helpModal.addEventListener('click', (e) => {
            if (e.target === elements.helpModal) {
                toggleHelpModal();
            }
        });

        // Inicializar sonidos
        Object.keys(sounds).forEach(key => {
            sounds[key].load();
        });

        // Inicializar estado de sonido
        toggleSound();
        toggleSound();
    </script>
</body>
</html>