<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Sustantivo</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* Variables CSS para personalizaci√≥n */
        :root {
            --primary: #07145e;
            --secondary: #f59e42;
            --success: #10b981;
            --danger: #ef4444;
            --bg-start: #1a3a5f;
            --bg-end: #0d2340;
            --card-bg: #FFFFFF;
            --text-dark: #1e3a8a;
            --text-medium: #334155;
            --text-light: #6b7280;
            --hint-bg: #e0effc;
            --confetti-colors: #d946ef, #ff9f43, #3b82f6, #10b981, #facc15;
            --shadow: 0px 8px 24px rgba(0, 0, 0, 0.1);
            --transition: 180ms ease;
            --final-score-color: #0055e0;
            --container-max-width: 1200px;
        }

        /* Estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to bottom, var(--bg-start), var(--bg-end));
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            position: relative;
            overflow-x: hidden;
        }

        /* Contenedor principal */
        .container {
            width: 100%;
            max-width: var(--container-max-width);
            background-color: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        /* Tipograf√≠a */
        h1, h2, h3 {
            margin-bottom: 16px;
            color: var(--text-dark);
            font-weight: 700;
        }

        h1 {
            font-size: 2.5em;
            text-align: center;
            color: var(--primary);
        }

        h2 {
            font-size: 1.8em;
        }

        h3 {
            font-size: 1.4em;
        }

        p {
            margin-bottom: 16px;
            color: var(--text-light);
        }

        /* Botones */
        .btn {
            display: inline-block;
            padding: 15px 40px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition);
            text-align: center;
            text-decoration: none;
            min-height: 44px;
            min-width: 44px;
            position: relative;
            z-index: 10;
        }

        .btn:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background-color: var(--primary);
        }

        .btn-primary:hover {
            filter: brightness(1.1);
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            filter: brightness(1.1);
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            filter: brightness(1.1);
        }

        .btn-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: 50%;
            background-color: transparent;
            color: var(--text-dark);
            position: relative;
            z-index: 10;
        }

        .btn-icon:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
            position: relative;
            z-index: 10;
        }

        .btn-group-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
            position: relative;
            z-index: 10;
        }

        /* Pantallas */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
            position: relative;
            z-index: 5;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Pantalla de inicio */
        .start-screen {
            text-align: center;
        }

        .start-screen h1 {
            margin-bottom: 24px;
        }

        .start-screen h2 {
            color: var(--text-medium);
            margin-bottom: 20px;
        }

        .start-screen p {
            max-width: 600px;
            margin: 0 auto 24px;
            font-size: 1.2em;
            color: var(--text-light);
        }

        .hint-card {
            background-color: var(--hint-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 20px auto;
            max-width: 650px;
            color: var(--text-medium);
            font-size: 1.1em;
        }

        .hint-card span {
            font-weight: 700;
            color: var(--secondary);
        }

        .start-image {
            max-width: 100%;
            margin: 20px auto;
            display: block;
            border-radius: 12px;
        }

        /* Barra de progreso */
        .progress-bar {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 24px;
            overflow: hidden;
            position: relative;
            z-index: 5;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--secondary);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: right;
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        /* Controles superiores */
        .top-controls {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 20;
        }

        .timer {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--card-bg);
            padding: 6px 12px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            font-weight: 600;
            font-size: 14px;
            z-index: 20;
        }

        .top-buttons {
            display: flex;
            gap: 8px;
        }

        /* Contenedor de palabra y opciones */
        .word-container {
            margin: 30px 0;
            text-align: center;
            position: relative;
            z-index: 5;
        }

        .word-display {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 24px;
            letter-spacing: 1px;
            padding: 10px 20px;
            background-color: rgba(59, 130, 246, 0.05);
            border-radius: 10px;
            display: inline-block;
            text-transform: capitalize;
        }

        .instruction-text {
            font-style: italic;
            color: var(--text-medium);
            margin: 10px 0 20px;
            font-size: 1.1em;
        }

        .options-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .option-btn {
            padding: 15px 30px;
            background-color: var(--card-bg);
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            position: relative;
            z-index: 10;
            min-width: 150px;
        }

        .option-btn:hover {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .option-btn.correct {
            background-color: var(--success);
            color: white;
            border-color: var(--success);
        }

        .option-btn.incorrect {
            background-color: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .option-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .option-btn:disabled:hover {
            background-color: var(--card-bg);
            color: var(--text-dark);
            border-color: #e0e0e0;
            transform: none;
        }

        /* Feedback */
        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            display: none;
            animation: fadeIn 0.3s ease;
            position: relative;
            z-index: 5;
            font-size: 1.1em;
        }

        .feedback.success {
            background-color: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .feedback.error {
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .feedback.show {
            display: block;
        }

        /* Modal - Mejorado */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform var(--transition);
            position: relative;
            z-index: 1001;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--secondary);
        }

        .modal-close {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
            transition: all var(--transition);
            position: relative;
            z-index: 10;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .modal-close:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        /* Estilos mejorados para el contenido del modal de ayuda */
        .help-content h3 {
            color: var(--primary);
            margin-bottom: 24px;
            font-size: 1.6em;
            text-align: center;
            position: relative;
            padding-bottom: 15px;
        }

        .help-content h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            border-radius: 2px;
        }

        .help-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .help-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            transition: all var(--transition);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .help-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
        }

        .help-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
            border-color: var(--secondary);
        }

        .help-card h4 {
            color: var(--primary);
            margin-bottom: 16px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-card .icon {
            font-size: 1.5em;
        }

        .help-card p {
            margin-bottom: 12px;
            font-size: 1.05em;
            line-height: 1.7;
        }

        .highlight {
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
        }

        .highlight-gender {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .highlight-number {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .highlight-masculine {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
        }

        .highlight-feminine {
            background: linear-gradient(135deg, #ec4899, #db2777);
            color: white;
        }

        .highlight-singular {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .highlight-plural {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .help-examples {
            margin-top: 32px;
        }

        .help-examples h3 {
            color: var(--secondary);
            margin-bottom: 24px;
            font-size: 1.4em;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .example {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 24px rgba(245, 158, 66, 0.15);
            transition: all var(--transition);
            border: 2px solid var(--secondary);
            position: relative;
        }

        .example::before {
            content: 'üí°';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2em;
            background: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .example:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(245, 158, 66, 0.25);
        }

        .example-title {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 16px;
            font-size: 1.3em;
            padding-top: 10px;
        }

        .example-step {
            margin-bottom: 12px;
            padding-left: 30px;
            position: relative;
            font-size: 1.05em;
            line-height: 1.6;
        }

        .example-step::before {
            content: "‚úì";
            position: absolute;
            left: 8px;
            color: var(--success);
            font-weight: bold;
            font-size: 1.2em;
        }

        .example-result {
            font-weight: 700;
            margin-top: 16px;
            font-size: 1.2em;
            padding: 12px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 8px;
            border-left: 4px solid var(--success);
        }

        /* Pantalla final */
        .final-screen {
            text-align: center;
        }

        .trophy {
            font-size: 80px;
            margin: 20px 0;
            animation: trophyAnimation 2s ease-in-out infinite;
            display: none;
        }

        .trophy.show {
            display: block;
        }

        @keyframes trophyAnimation {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            75% { transform: scale(1.1) rotate(-5deg); }
        }

        .final-score {
            font-size: 3.5em;
            font-weight: 700;
            color: var(--final-score-color) !important;
            margin: 20px 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .final-score.perfect {
            color: var(--final-score-color) !important;
        }

        .final-time {
            font-size: 20px;
            color: var(--text-light);
            margin-bottom: 24px;
        }

        .final-message {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 24px;
        }

        .credit {
            margin-top: 20px;
            font-size: 14px;
            color: var(--text-light);
        }

        .school-logo {
            max-width: 150px;
            margin: 20px auto;
            display: block;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: confetti-fall 3s linear forwards;
            z-index: 9999;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translate(0, 0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) rotate(360deg);
                opacity: 0;
            }
        }

        /* Puntuaci√≥n en modo infinito */
        .infinite-score {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--card-bg);
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            font-weight: 600;
            font-size: 16px;
            z-index: 20;
        }

        /* Responsive */
        @media (min-width: 480px) {
            .container {
                padding: 30px;
            }
            
            h1 {
                font-size: 2.8em;
            }
            
            .word-display {
                font-size: 40px;
                padding: 12px 24px;
            }
            
            .trophy {
                font-size: 100px;
            }
        }
        
        @media (min-width: 768px) {
            h1 {
                font-size: 3.2em;
            }
            
            .word-display {
                font-size: 44px;
                padding: 14px 28px;
            }
            
            .top-controls {
                top: 20px;
                left: 20px;
            }
            
            .timer {
                top: 20px;
                right: 20px;
                padding: 10px 18px;
                font-size: 16px;
            }
            
            .trophy {
                font-size: 120px;
            }
        }

        /* Para pantallas muy peque√±as */
        @media (max-width: 767px) {
            .option-btn {
                width: 100%;
                max-width: 200px;
            }
            
            .word-display {
                font-size: 32px;
                padding: 8px 16px;
            }

            .modal-content {
                padding: 20px;
            }

            .help-grid {
                grid-template-columns: 1fr;
            }

            .examples-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Accesibilidad */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Animaciones reducidas */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .trophy {
                animation: none;
            }
        }
    </style>
</head>
<body>
    <div id="startScreen" class="screen start-screen active">
        <div class="container">
            <h1>El sustantivo</h1>
            <h2>G√©nero y n√∫mero de un sustantivo</h2>
            
            <div class="hint-card">
                Clasifica los siguientes sustantivos seg√∫n su <span>g√©nero</span> (masculino o femenino) y su <span>n√∫mero</span> (singular o plural).<br>
                <strong>Buena suerte.</strong>
            </div>
            
            <div class="btn-group">
                <button id="startBtn" class="btn" onclick="unlockAudio(); startGame()">Comenzar</button>
            </div>
            
            <img src="https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/refs/heads/main/Ni%C3%B1os.png" alt="Ni√±os estudiando" class="start-image">
        </div>
    </div>

    <div id="gameScreen" class="screen">
        <div class="container">
            <div class="top-controls">
                <button id="soundBtn" class="btn btn-icon" aria-label="Activar sonido" onclick="unlockAudio(); toggleSound()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                </button>
                <button id="helpBtnGame" class="btn btn-icon" aria-label="Ayuda" onclick="unlockAudio(); toggleHelpModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </button>
            </div>
            
            <div class="timer" id="timer">00:00</div>
            
            <div id="infiniteScore" class="infinite-score" style="display: none;">Puntuaci√≥n: 0</div>
            
            <div id="normalProgress" class="progress-text">1/10</div>
            <div id="normalProgressBar" class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 10%"></div>
            </div>
            
            <h2>Clasifica estos sustantivos seg√∫n su g√©nero y n√∫mero</h2>
            
            <div class="word-container">
                <div class="word-display" id="wordDisplay">Sustantivo</div>
                
                <div id="genderQuestion" class="question-container">
                    <p class="instruction-text">¬øCu√°l es su g√©nero?</p>
                    <div class="options-container">
                        <button id="masculineBtn" class="option-btn" onclick="unlockAudio(); checkGender('masculine')">Masculino</button>
                        <button id="feminineBtn" class="option-btn" onclick="unlockAudio(); checkGender('feminine')">Femenino</button>
                    </div>
                </div>
                
                <div id="numberQuestion" class="question-container" style="display: none;">
                    <p class="instruction-text">¬øCu√°l es su n√∫mero?</p>
                    <div class="options-container">
                        <button id="singularBtn" class="option-btn" onclick="unlockAudio(); checkNumber('singular')">Singular</button>
                        <button id="pluralBtn" class="option-btn" onclick="unlockAudio(); checkNumber('plural')">Plural</button>
                    </div>
                </div>
            </div>
            
            <div class="btn-group-row">
                <button id="continueBtn" class="btn btn-success" style="display: none;" onclick="unlockAudio(); nextWord()">Continuar</button>
                <button id="exitInfiniteBtn" class="btn" style="display: none;" onclick="unlockAudio(); exitInfiniteMode()">Salir</button>
            </div>
            
            <div id="feedback" class="feedback" aria-live="polite"></div>
        </div>
    </div>

    <div id="finalScreen" class="screen final-screen">
        <div class="container">
            <div class="top-controls">
                <button id="soundBtnFinal" class="btn btn-icon" aria-label="Activar sonido" onclick="unlockAudio(); toggleSound()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                </button>
            </div>
            
            <h1>El sustantivo</h1>
            
            <div id="trophyContainer" class="trophy">üèÜ</div>
            
            <h2>Puntuaci√≥n:</h2>
            <div class="final-score" id="finalScore">0</div>
            
            <div class="final-time" id="finalTime">Tiempo: 00:00</div>
            
            <p id="finalMessage"></p>
            
            <div class="btn-group">
                <button id="restartBtn" class="btn" onclick="unlockAudio(); restartGame()">Volver a jugar</button>
                <button id="infiniteModeBtn" class="btn btn-primary" onclick="unlockAudio(); startInfiniteMode()">Entrenamiento infinito</button>
            </div>
            
            <p class="credit">Created by Manuel J. Ventura</p>
            
            <img src="https://github.com/ManuelVS8/Efectos_audio/blob/1e2a36cdd1f8bedcb578a30f5ec5cc8f21c287fe/Siurot.png?raw=true" alt="Logo del colegio" class="school-logo">
        </div>
    </div>

    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìö ¬øC√≥mo clasificar sustantivos?</h2>
                <button class="modal-close" id="closeHelpModal" onclick="unlockAudio(); toggleHelpModal()">√ó</button>
            </div>
            <div class="help-content">
                <h3>üéØ Pasos a seguir</h3>
                
                <div class="help-grid">
                    <div class="help-card">
                        <h4><span class="icon">‚ôÇÔ∏è‚ôÄÔ∏è</span> Identificar el <span class="highlight highlight-gender">g√©nero</span></h4>
                        <p>‚Ä¢ Si puede llevar delante "<span class="highlight highlight-masculine">el</span>" o "<span class="highlight highlight-masculine">los</span>" es <span class="highlight highlight-masculine">masculino</span></p>
                        <p>‚Ä¢ Si puede llevar delante "<span class="highlight highlight-feminine">la</span>" o "<span class="highlight highlight-feminine">las</span>" es <span class="highlight highlight-feminine">femenino</span></p>
                    </div>
                    
                    <div class="help-card">
                        <h4><span class="icon">üî¢</span> Identificar el <span class="highlight highlight-number">n√∫mero</span></h4>
                        <p>‚Ä¢ Si se refiere a un solo elemento es <span class="highlight highlight-singular">singular</span></p>
                        <p>‚Ä¢ Si se refiere a m√°s de un elemento es <span class="highlight highlight-plural">plural</span></p>
                        <p>‚Ä¢ Los plurales suelen terminar en <strong>-s</strong> o <strong>-es</strong></p>
                    </div>
                </div>
                
                <div class="help-examples">
                    <h3>üí° Ejemplos pr√°cticos</h3>
                    
                    <div class="examples-grid">
                        <div class="example">
                            <div class="example-title">üìò "Libro"</div>
                            <div class="example-step">Podemos decir "<span class="highlight highlight-masculine">el libro</span>" ‚Üí es <span class="highlight highlight-masculine">masculino</span></div>
                            <div class="example-step">Se refiere a un solo libro ‚Üí es <span class="highlight highlight-singular">singular</span></div>
                            <div class="example-result">‚úÖ Resultado: <span class="highlight highlight-masculine">Masculino</span> <span class="highlight highlight-singular">singular</span></div>
                        </div>
                        
                        <div class="example">
                            <div class="example-title">üìö "Mesas"</div>
                            <div class="example-step">Podemos decir "<span class="highlight highlight-feminine">las mesas</span>" ‚Üí es <span class="highlight highlight-feminine">femenino</span></div>
                            <div class="example-step">Termina en -s y se refiere a varias ‚Üí es <span class="highlight highlight-plural">plural</span></div>
                            <div class="example-result">‚úÖ Resultado: <span class="highlight highlight-feminine">Femenino</span> <span class="highlight highlight-plural">plural</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Base de datos de sustantivos - Corregida seg√∫n castellano de Espa√±a
        const sustantivos = {
            'masculino-singular': [
                'libro', 'perro', 'gato', '√°rbol', 'coche', 'sol', 'cielo', 'r√≠o', 'monta√±a', 'p√°jaro',
                'camino', 'puente', 'jard√≠n', 'castillo', 'rey', 'hombre', 'ni√±o', 'caballo', 'le√≥n', 'tigre',
                'elefante', 'avi√≥n', 'tren', 'barco', 'edificio', 'hospital', 'parque', 'museo', 'bol√≠grafo',
                'ordenador', 'tel√©fono', 'reloj', 'zapato', 'sombrero', 'pantal√≥n', 'vestido', 'abrigo', 'guante',
                'cuaderno', 'l√°piz', 'borrador', 'armario', 'cama', 'sof√°', 'espejo', 'cuadro', 'vaso', 'plato',
                'tenedor', 'cuchillo', 'cuchara', 'zapato', 'bot√≥n', 'reloj', 'coche', 'autob√∫s', 'cami√≥n', 'moto',
                'bicicleta', 'tren', 'avi√≥n', 'barco', 'puerto', 'aeropuerto', 'estaci√≥n', 'teatro', 'cine', 'museo',
                'restaurante', 'caf√©', 'hotel', 'hospital', 'mercado', 'supermercado', 'tienda', 'banco', 'oficina', 'f√°brica'
            ],
            'masculino-plural': [
                'libros', 'perros', 'gatos', '√°rboles', 'coches', 'soles', 'cielos', 'r√≠os', 'monta√±as', 'p√°jaros',
                'caminos', 'puentes', 'jardines', 'castillos', 'reyes', 'hombres', 'ni√±os', 'caballos', 'leones', 'tigres',
                'elefantes', 'aviones', 'trenes', 'barcos', 'edificios', 'hospitales', 'parques', 'museos', 'bol√≠grafos',
                'ordenadores', 'tel√©fonos', 'relojes', 'zapatos', 'sombreros', 'pantalones', 'vestidos', 'abrigos', 'guantes',
                'cuadernos', 'l√°pices', 'borradores', 'armarios', 'camas', 'sof√°s', 'espejos', 'cuadros', 'vasos', 'platos',
                'tenedores', 'cuchillos', 'cucharas', 'zapatos', 'botones', 'relojes', 'coches', 'autobuses', 'camiones', 'motos',
                'bicicletas', 'trenes', 'aviones', 'barcos', 'puertos', 'aeropuertos', 'estaciones', 'teatros', 'cines', 'museos',
                'restaurantes', 'caf√©s', 'hoteles', 'hospitales', 'mercados', 'supermercados', 'tiendas', 'bancos', 'oficinas', 'f√°bricas'
            ],
            'femenino-singular': [
                'casa', 'mesa', 'silla', 'puerta', 'ventana', 'flor', 'estrella', 'luna', 'playa', 'ciudad',
                'iglesia', 'tienda', 'calle', 'plaza', 'fuente', 'isla', 'pen√≠nsula', 'mariposa', 'abeja', 'gallina',
                'vaca', 'oveja', 'jirafa', 'ballena', 'tortuga', 'serpiente', 'lagartija', 'manzana', 'naranja', 'banana',
                'fresa', 'uva', 'sand√≠a', 'melocot√≥n', 'pera', 'lim√≥n', 'ciruela', 'cereza', 'rosa', 'tulip√°n',
                'margarita', 'girasol', 'orqu√≠dea', 'dalia', 'clavel', 'lirio', 'azucena', 'violeta', 'camisa', 'falda',
                'blusa', 'chaqueta', 'bufanda', 'gorra', 'bolso', 'cartera', 'moneda', 'llave', 'carta', 'foto',
                'pel√≠cula', 'canci√≥n', 'm√∫sica', 'historia', 'novela', 'poes√≠a', 'obra', 'pintura', 'escultura', 'danza',
                'escuela', 'universidad', 'clase', 'lecci√≥n', 'tarea', 'prueba', 'nota', 'matr√≠cula', 'beca', 'diploma'
            ],
            'femenino-plural': [
                'casas', 'mesas', 'sillas', 'puertas', 'ventanas', 'flores', 'estrellas', 'lunas', 'playas', 'ciudades',
                'iglesias', 'tiendas', 'calles', 'plazas', 'fuentes', 'islas', 'pen√≠nsulas', 'mariposas', 'abejas', 'gallinas',
                'vacas', 'ovejas', 'jirafas', 'ballenas', 'tortugas', 'serpientes', 'lagartijas', 'manzanas', 'naranjas', 'bananas',
                'fresas', 'uvas', 'sand√≠as', 'melocotones', 'peras', 'limones', 'ciruelas', 'cerezas', 'rosas', 'tulipanes',
                'margaritas', 'girasoles', 'orqu√≠deas', 'dalias', 'claveles', 'lirios', 'azucenas', 'violetas', 'camisas', 'faldas',
                'blusas', 'chaquetas', 'bufandas', 'gorras', 'bolsos', 'carteras', 'monedas', 'llaves', 'cartas', 'fotos',
                'pel√≠culas', 'canciones', 'm√∫sicas', 'historias', 'novelas', 'poes√≠as', 'obras', 'pinturas', 'esculturas', 'danzas',
                'escuelas', 'universidades', 'clases', 'lecciones', 'tareas', 'pruebas', 'notas', 'matr√≠culas', 'becas', 'diplomas'
            ]
        };

        // Estado del juego
        let gameState = {
            words: [],
            currentWordIndex: 0,
            score: 0,
            startTime: null,
            timerInterval: null,
            soundEnabled: true,
            currentWord: '',
            currentGender: '',
            currentNumber: '',
            gameMode: 'normal', // 'normal' o 'infinite'
            infiniteScore: 0,
            wordsUsed: [],
            questionStep: 'gender', // 'gender' o 'number'
            isProcessing: false // Para evitar m√∫ltiples clics r√°pidos
        };

        // Elementos del DOM
        const elements = {
            startScreen: document.getElementById('startScreen'),
            gameScreen: document.getElementById('gameScreen'),
            finalScreen: document.getElementById('finalScreen'),
            startBtn: document.getElementById('startBtn'),
            helpBtnGame: document.getElementById('helpBtnGame'),
            helpModal: document.getElementById('helpModal'),
            closeHelpModal: document.getElementById('closeHelpModal'),
            wordDisplay: document.getElementById('wordDisplay'),
            genderQuestion: document.getElementById('genderQuestion'),
            numberQuestion: document.getElementById('numberQuestion'),
            masculineBtn: document.getElementById('masculineBtn'),
            feminineBtn: document.getElementById('feminineBtn'),
            singularBtn: document.getElementById('singularBtn'),
            pluralBtn: document.getElementById('pluralBtn'),
            continueBtn: document.getElementById('continueBtn'),
            exitInfiniteBtn: document.getElementById('exitInfiniteBtn'),
            soundBtn: document.getElementById('soundBtn'),
            soundBtnFinal: document.getElementById('soundBtnFinal'),
            feedback: document.getElementById('feedback'),
            progressText: document.getElementById('normalProgress'),
            progressFill: document.getElementById('progressFill'),
            normalProgressBar: document.getElementById('normalProgressBar'),
            normalProgress: document.getElementById('normalProgress'),
            infiniteScore: document.getElementById('infiniteScore'),
            timer: document.getElementById('timer'),
            finalScore: document.getElementById('finalScore'),
            finalTime: document.getElementById('finalTime'),
            finalMessage: document.getElementById('finalMessage'),
            restartBtn: document.getElementById('restartBtn'),
            infiniteModeBtn: document.getElementById('infiniteModeBtn'),
            trophyContainer: document.getElementById('trophyContainer')
        };

        // Sistema de sonido con archivos externos
        const soundFiles = {
            correct: 'https://github.com/ManuelVS8/Efectos_audio/blob/7b86808e254100aeaba6285b3e0b82650ae78055/Correcto.mp3?raw=true',
            error: 'https://github.com/ManuelVS8/Efectos_audio/blob/7b86808e254100aeaba6285b3e0b82650ae78055/Error.mp3?raw=true',
            completed: 'https://github.com/ManuelVS8/Efectos_audio/blob/7b86808e254100aeaba6285b3e0b82650ae78055/Completado.mp3?raw=true',
            victory: 'https://github.com/ManuelVS8/Efectos_audio/blob/7b86808e254100aeaba6285b3e0b82650ae78055/Termin%C3%A9.mp3?raw=true',
            tap: 'https://github.com/ManuelVS8/Efectos_audio/blob/37b3eb2da9c15c04dfb71dfe1be60f088ea3cdfc/Tap.mp3?raw=true'
        };
        
        const sounds = {};
        let audioUnlocked = false;

        // Cargar todos los sonidos al inicio
        Object.keys(soundFiles).forEach(key => {
            sounds[key] = new Audio(soundFiles[key]);
            sounds[key].load();
        });

        // Funci√≥n de desbloqueo de audio
        function unlockAudio() {
            if (audioUnlocked) return;
            
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                
                if (ctx.state === 'suspended') {
                    ctx.resume();
                }

                const buffer = ctx.createBuffer(1, 1, 22050);
                const source = ctx.createBufferSource();
                source.buffer = buffer;
                source.connect(ctx.destination);
                
                source.start(0);
                
                source.onended = () => {
                    audioUnlocked = true;
                    console.log("AudioContext desbloqueado.");
                    Object.keys(sounds).forEach(key => {
                        sounds[key].load();
                    });
                };
            } catch (e) {
                console.warn("Error al intentar desbloquear AudioContext, usando fallback de Audio()");
                audioUnlocked = true;
            } finally {
                if (!audioUnlocked) {
                    audioUnlocked = true;
                    Object.keys(sounds).forEach(key => {
                        sounds[key].load();
                    });
                }
            }
        }

        // Funciones para reproducir sonidos
        function reproducirSonidoCorrecto() {
            if (audioUnlocked && sounds.correct && gameState.soundEnabled) {
                sounds.correct.currentTime = 0;
                sounds.correct.play().catch(e => console.log("Error al reproducir sonido correcto:", e));
            }
        }

        function reproducirSonidoError() {
            if (audioUnlocked && sounds.error && gameState.soundEnabled) {
                sounds.error.currentTime = 0;
                sounds.error.play().catch(e => console.log("Error al reproducir sonido de error:", e));
            }
        }

        function reproducirSonidoCompletado() {
            if (audioUnlocked && sounds.completed && gameState.soundEnabled) {
                sounds.completed.currentTime = 0;
                sounds.completed.play().catch(e => console.log("Error al reproducir sonido completado:", e));
            }
        }

        function reproducirSonidoVictoria() {
            if (audioUnlocked && sounds.victory && gameState.soundEnabled) {
                sounds.victory.currentTime = 0;
                sounds.victory.play().catch(e => console.log("Error al reproducir sonido de victoria:", e));
            }
        }

        function reproducirSonidoTap() {
            if (audioUnlocked && sounds.tap && gameState.soundEnabled) {
                sounds.tap.currentTime = 0;
                sounds.tap.play().catch(e => console.log("Error al reproducir sonido tap:", e));
            }
        }

        // Funci√≥n para generar palabras para el juego - Mejorada para evitar repeticiones
        function generateWords() {
            const words = [];
            const usedWordsInThisGame = new Set();
            
            // Funci√≥n auxiliar para obtener una palabra aleatoria sin repetir
            function getRandomWordFromType(type) {
                const availableWords = sustantivos[type].filter(word => 
                    !gameState.wordsUsed.includes(word) && !usedWordsInThisGame.has(word)
                );
                
                if (availableWords.length === 0) {
                    // Si no hay palabras disponibles, reiniciar el array de palabras usadas globalmente
                    console.warn(`No hay palabras disponibles de tipo ${type}, reiniciando palabras usadas globalmente`);
                    // Reiniciar solo las palabras de este tipo
                    const allWordsOfType = sustantivos[type];
                    const randomIndex = Math.floor(Math.random() * allWordsOfType.length);
                    return allWordsOfType[randomIndex];
                }
                
                const randomIndex = Math.floor(Math.random() * availableWords.length);
                const word = availableWords[randomIndex];
                usedWordsInThisGame.add(word);
                return word;
            }
            
            // A√±adir 2 de cada tipo
            for (let i = 0; i < 2; i++) {
                words.push({
                    word: getRandomWordFromType('masculino-singular'),
                    type: 'masculino-singular'
                });
                words.push({
                    word: getRandomWordFromType('masculino-plural'),
                    type: 'masculino-plural'
                });
                words.push({
                    word: getRandomWordFromType('femenino-singular'),
                    type: 'femenino-singular'
                });
                words.push({
                    word: getRandomWordFromType('femenino-plural'),
                    type: 'femenino-plural'
                });
            }
            
            // A√±adir 2 aleatorios
            const types = ['masculino-singular', 'masculino-plural', 'femenino-singular', 'femenino-plural'];
            for (let i = 0; i < 2; i++) {
                const randomType = types[Math.floor(Math.random() * types.length)];
                words.push({
                    word: getRandomWordFromType(randomType),
                    type: randomType
                });
            }
            
            // Mezclar el orden de las palabras
            return shuffleArray(words);
        }

        // Funci√≥n para mezclar un array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Funci√≥n para mostrar la palabra actual
        function showWord() {
            const wordObj = gameState.words[gameState.currentWordIndex];
            gameState.currentWord = wordObj.word;
            gameState.currentGender = wordObj.type.includes('masculino') ? 'masculine' : 'feminine';
            gameState.currentNumber = wordObj.type.includes('singular') ? 'singular' : 'plural';
            gameState.questionStep = 'gender';
            gameState.isProcessing = false;
            
            elements.wordDisplay.textContent = gameState.currentWord;
            
            // Actualizar progreso (solo en modo normal)
            if (gameState.gameMode === 'normal') {
                elements.progressText.textContent = `${gameState.currentWordIndex + 1}/${gameState.words.length}`;
                elements.progressFill.style.width = `${((gameState.currentWordIndex + 1) / gameState.words.length) * 100}%`;
            }
            
            // Resetear botones
            resetButtons();
            
            // Mostrar pregunta de g√©nero
            elements.genderQuestion.style.display = 'block';
            elements.numberQuestion.style.display = 'none';
            
            // Ocultar feedback y bot√≥n continuar
            elements.feedback.classList.remove('show');
            elements.continueBtn.style.display = 'none';
        }

        // Funci√≥n para resetear los botones
        function resetButtons() {
            elements.masculineBtn.disabled = false;
            elements.feminineBtn.disabled = false;
            elements.singularBtn.disabled = false;
            elements.pluralBtn.disabled = false;
            
            elements.masculineBtn.classList.remove('correct', 'incorrect');
            elements.feminineBtn.classList.remove('correct', 'incorrect');
            elements.singularBtn.classList.remove('correct', 'incorrect');
            elements.pluralBtn.classList.remove('correct', 'incorrect');
        }

        // Funci√≥n para comprobar el g√©nero
        function checkGender(selectedGender) {
            if (gameState.isProcessing) return;
            gameState.isProcessing = true;
            
            const correctGender = gameState.currentGender;
            const isCorrect = selectedGender === correctGender;
            
            // Deshabilitar botones de g√©nero
            elements.masculineBtn.disabled = true;
            elements.feminineBtn.disabled = true;
            
            // Resaltar bot√≥n correcto e incorrecto
            if (selectedGender === 'masculine') {
                elements.masculineBtn.classList.add(isCorrect ? 'correct' : 'incorrect');
            } else {
                elements.feminineBtn.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
            
            if (!isCorrect) {
                // Resaltar tambi√©n el bot√≥n correcto
                if (correctGender === 'masculine') {
                    elements.masculineBtn.classList.add('correct');
                } else {
                    elements.feminineBtn.classList.add('correct');
                }
                
                // Mostrar feedback de error
                elements.feedback.className = 'feedback error show';
                elements.feedback.innerHTML = `<p><strong>No es correcto.</strong> El g√©nero correcto es ${correctGender === 'masculine' ? 'masculino' : 'femenino'}.</p>`;
                
                // Reproducir sonido de error
                reproducirSonidoError();
                
                // Mostrar bot√≥n continuar
                elements.continueBtn.style.display = 'inline-block';
            } else {
                // Reproducir sonido de √©xito
                reproducirSonidoCorrecto();
                
                // Mostrar pregunta de n√∫mero autom√°ticamente
                setTimeout(() => {
                    elements.genderQuestion.style.display = 'none';
                    elements.numberQuestion.style.display = 'block';
                    gameState.isProcessing = false;
                }, 1000);
            }
        }

        // Funci√≥n para comprobar el n√∫mero
        function checkNumber(selectedNumber) {
            if (gameState.isProcessing) return;
            gameState.isProcessing = true;
            
            const correctNumber = gameState.currentNumber;
            const isCorrect = selectedNumber === correctNumber;
            
            // Deshabilitar botones de n√∫mero
            elements.singularBtn.disabled = true;
            elements.pluralBtn.disabled = true;
            
            // Resaltar bot√≥n correcto e incorrecto
            if (selectedNumber === 'singular') {
                elements.singularBtn.classList.add(isCorrect ? 'correct' : 'incorrect');
            } else {
                elements.pluralBtn.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
            
            if (!isCorrect) {
                // Resaltar tambi√©n el bot√≥n correcto
                if (correctNumber === 'singular') {
                    elements.singularBtn.classList.add('correct');
                } else {
                    elements.pluralBtn.classList.add('correct');
                }
                
                // Mostrar feedback de error
                elements.feedback.className = 'feedback error show';
                elements.feedback.innerHTML = `<p><strong>No es correcto.</strong> El n√∫mero correcto es ${correctNumber === 'singular' ? 'singular' : 'plural'}.</p>`;
                
                // Reproducir sonido de error
                reproducirSonidoError();
                
                // Mostrar bot√≥n continuar
                elements.continueBtn.style.display = 'inline-block';
            } else {
                // Reproducir sonido de √©xito
                reproducirSonidoCorrecto();
                
                // Actualizar puntuaci√≥n
                gameState.score += 1;
                
                // Si estamos en modo infinito, aumentar puntuaci√≥n
                if (gameState.gameMode === 'infinite') {
                    gameState.infiniteScore += 10;
                    elements.infiniteScore.textContent = `Puntuaci√≥n: ${gameState.infiniteScore}`;
                }
                
                // Pasar autom√°ticamente a la siguiente palabra
                setTimeout(() => {
                    nextWord();
                }, 1500);
            }
        }

        // Funci√≥n para continuar a la siguiente palabra
        function nextWord() {
            reproducirSonidoTap();
            
            if (gameState.gameMode === 'normal') {
                gameState.currentWordIndex++;
                
                if (gameState.currentWordIndex < gameState.words.length) {
                    showWord();
                } else {
                    endGame();
                }
            } else {
                // Modo infinito: generar una nueva palabra
                generateNewInfiniteWord();
            }
        }

        // Funci√≥n para generar una nueva palabra en modo infinito
        function generateNewInfiniteWord() {
            const types = ['masculino-singular', 'masculino-plural', 'femenino-singular', 'femenino-plural'];
            const randomType = types[Math.floor(Math.random() * types.length)];
            
            // Obtener palabra sin repetir
            const availableWords = sustantivos[randomType].filter(word => !gameState.wordsUsed.includes(word));
            let selectedWord;
            
            if (availableWords.length === 0) {
                // Si no hay palabras disponibles, reiniciar el array de palabras usadas
                console.warn("Reiniciando palabras usadas en modo infinito");
                gameState.wordsUsed = [];
                selectedWord = sustantivos[randomType][Math.floor(Math.random() * sustantivos[randomType].length)];
            } else {
                const randomIndex = Math.floor(Math.random() * availableWords.length);
                selectedWord = availableWords[randomIndex];
            }
            
            gameState.wordsUsed.push(selectedWord);
            
            const newWord = {
                word: selectedWord,
                type: randomType
            };
            
            gameState.words = [newWord];
            gameState.currentWordIndex = 0;
            
            showWord();
        }

        // Funci√≥n para iniciar el juego
        function startGame() {
            reproducirSonidoTap();
            
            // Reiniciar estado del juego
            gameState.words = generateWords();
            gameState.currentWordIndex = 0;
            gameState.score = 0;
            gameState.startTime = Date.now();
            gameState.gameMode = 'normal';
            gameState.infiniteScore = 0;
            gameState.wordsUsed = [];
            gameState.isProcessing = false;
            
            // Iniciar temporizador
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            gameState.timerInterval = setInterval(updateTimer, 1000);
            
            // Cambiar a pantalla de juego
            elements.startScreen.classList.remove('active');
            elements.gameScreen.classList.add('active');
            
            // Mostrar elementos de modo normal
            elements.normalProgress.style.display = 'block';
            elements.normalProgressBar.style.display = 'block';
            elements.infiniteScore.style.display = 'none';
            elements.exitInfiniteBtn.style.display = 'none';
            
            // Mostrar primera palabra
            showWord();
        }

        // Funci√≥n para iniciar el modo infinito
        function startInfiniteMode() {
            reproducirSonidoTap();
            
            // Reiniciar estado del juego
            gameState.words = [null]; // Placeholder para la primera palabra
            gameState.currentWordIndex = 0;
            gameState.score = 0;
            gameState.startTime = Date.now();
            gameState.gameMode = 'infinite';
            gameState.infiniteScore = 0;
            gameState.wordsUsed = [];
            gameState.isProcessing = false;
            
            // Iniciar temporizador
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            gameState.timerInterval = setInterval(updateTimer, 1000);
            
            // Cambiar a pantalla de juego
            elements.finalScreen.classList.remove('active');
            elements.gameScreen.classList.add('active');
            
            // Mostrar elementos de modo infinito
            elements.normalProgress.style.display = 'none';
            elements.normalProgressBar.style.display = 'none';
            elements.infiniteScore.style.display = 'block';
            elements.exitInfiniteBtn.style.display = 'inline-block';
            elements.infiniteScore.textContent = `Puntuaci√≥n: 0`;
            
            // Generar primera palabra
            generateNewInfiniteWord();
        }

        // Funci√≥n para salir del modo infinito
        function exitInfiniteMode() {
            reproducirSonidoTap();
            
            // Detener temporizador
            clearInterval(gameState.timerInterval);
            
            // Cambiar a pantalla de inicio
            elements.gameScreen.classList.remove('active');
            elements.startScreen.classList.add('active');
        }

        // Funci√≥n para actualizar el temporizador
        function updateTimer() {
            if (!gameState.startTime) return;
            
            const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            elements.timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Funci√≥n para finalizar el juego
        function endGame() {
            // Detener temporizador
            clearInterval(gameState.timerInterval);
            
            // Calcular puntuaci√≥n
            const score = (gameState.score * 100) / 10;
            
            // Calcular tiempo
            const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Cambiar a pantalla final
            elements.gameScreen.classList.remove('active');
            elements.finalScreen.classList.add('active');
            
            // Mostrar resultados
            elements.finalScore.textContent = score;
            elements.finalTime.textContent = `Tiempo: ${timeStr}`;
            
            // Mensaje motivador
            if (score === 100) {
                elements.finalMessage.textContent = '¬°Genial! ¬°Puntuaci√≥n perfecta!';
                elements.trophyContainer.classList.add('show');
                elements.finalScore.classList.add('perfect');
                
                // Celebraci√≥n con confeti
                createConfetti();
                
                // Reproducir melod√≠a de victoria despu√©s de un peque√±o retraso
                setTimeout(() => {
                    reproducirSonidoVictoria();
                }, 500);
            } else {
                elements.trophyContainer.classList.remove('show');
                elements.finalScore.classList.remove('perfect');
                
                if (score >= 80) {
                    elements.finalMessage.textContent = 'Casi lo logras. ¬°Sigue practicando!';
                } else if (score >= 50) {
                    elements.finalMessage.textContent = 'No est√° mal, pero a√∫n puedes hacerlo mejor';
                } else {
                    elements.finalMessage.textContent = 'Vaya desastre... ¬øSeguro que has estudiado?';
                }
                
                // Reproducir sonido de completado despu√©s de un peque√±o retraso
                setTimeout(() => {
                    reproducirSonidoCompletado();
                }, 500);
            }
        }

        // Funci√≥n para crear confeti
        function createConfetti() {
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    const x = Math.random() * window.innerWidth;
                    const y = -10;
                    
                    const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ffa500', '#ff69b4'];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    confetti.style.left = `${x}px`;
                    confetti.style.top = `${y}px`;
                    confetti.style.backgroundColor = color;
                    
                    const size = Math.random() * 10 + 5;
                    confetti.style.width = `${size}px`;
                    confetti.style.height = `${size}px`;
                    
                    const tx = (Math.random() - 0.5) * 100;
                    const ty = window.innerHeight + 10;
                    
                    confetti.style.setProperty('--tx', `${tx}px`);
                    confetti.style.setProperty('--ty', `${ty}px`);
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }, i * 30);
            }
        }

        // Funci√≥n para reiniciar el juego
        function restartGame() {
            reproducirSonidoTap();
            
            elements.finalScreen.classList.remove('active');
            elements.startScreen.classList.add('active');
        }

        // Funci√≥n para alternar sonido
        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            
            const soundIcon = `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            `;
            
            const muteIcon = `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <line x1="23" y1="9" x2="17" y2="15"></line>
                    <line x1="17" y1="9" x2="23" y2="15"></line>
                </svg>
            `;
            
            if (gameState.soundEnabled) {
                elements.soundBtn.innerHTML = soundIcon + '<path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>';
                if (elements.soundBtnFinal) {
                    elements.soundBtnFinal.innerHTML = soundIcon + '<path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>';
                }
            } else {
                elements.soundBtn.innerHTML = soundIcon + '<line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>';
                if (elements.soundBtnFinal) {
                    elements.soundBtnFinal.innerHTML = soundIcon + '<line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>';
                }
            }
            
            reproducirSonidoTap();
        }

        // Funci√≥n para mostrar/ocultar modal de ayuda
        function toggleHelpModal() {
            reproducirSonidoTap();
            elements.helpModal.classList.toggle('active');
        }

        // Soporte de teclado
        document.addEventListener('keydown', (e) => {
            if (!elements.gameScreen.classList.contains('active')) return;
            
            if (!audioUnlocked) {
                unlockAudio();
            }

            if (gameState.questionStep === 'gender') {
                if (e.key === '1' || e.key === 'm' || e.key === 'M') {
                    checkGender('masculine');
                } else if (e.key === '2' || e.key === 'f' || e.key === 'F') {
                    checkGender('feminine');
                }
            } else if (gameState.questionStep === 'number') {
                if (e.key === '1' || e.key === 's' || e.key === 'S') {
                    checkNumber('singular');
                } else if (e.key === '2' || e.key === 'p' || e.key === 'P') {
                    checkNumber('plural');
                }
            }
            
            if (e.key === 'Enter') {
                if (elements.continueBtn.style.display !== 'none') {
                    nextWord();
                }
            }
            
            if (e.key === 'Escape' && elements.helpModal.classList.contains('active')) {
                toggleHelpModal();
            }
        });

        // Cerrar modal al hacer clic fuera
        elements.helpModal.addEventListener('click', (e) => {
            if (e.target === elements.helpModal) {
                toggleHelpModal();
            }
        });

        // Inicializar sonidos
        Object.keys(sounds).forEach(key => {
            sounds[key].load();
        });

        // Inicializar estado de sonido
        toggleSound();
        toggleSound();
    </script>
</body>
</html>